<div class="container my-5">
  <h1 class="text-center mb-5">Generador de Grupos para Torneos</h1>

  <!-- DATOS GENERALES -->
  <div class="card mb-4">
    <div class="card-header bg-primary text-white">
      <h2 class="h4 mb-0">Datos Generales</h2>
    </div>
    <div class="card-body">
      <!-- Nombre del torneo -->
      <div class="mb-3">
        <label for="tournamentName" class="form-label">Nombre del Torneo</label>
        <input 
          type="text" 
          class="form-control" 
          id="tournamentName" 
          [(ngModel)]="tournamentName"
          placeholder="Ingrese el nombre del torneo">
      </div>

      <!-- Número de categorías -->
      <div class="mb-3">
        <label for="numberOfCategories" class="form-label">Número de Categorías</label>
        <select 
          class="form-select" 
          id="numberOfCategories" 
          [(ngModel)]="numberOfCategories"
          (change)="onNumberOfCategoriesChange()">
          <option [value]="1">1</option>
          <option [value]="2">2</option>
          <option [value]="3">3</option>
          <option [value]="4">4</option>
          <option [value]="5">5</option>
        </select>
      </div>

      <!-- Nombres de las categorías -->
      <div class="mb-3" *ngFor="let category of categories">
        <label [for]="'category' + category.id" class="form-label">
          Nombre de la Categoría {{ category.id }}
        </label>
        <input 
          type="text" 
          class="form-control" 
          [id]="'category' + category.id" 
          [(ngModel)]="category.name"
          placeholder="Nombre de la categoría">
      </div>

      <!-- Grupos mezclados -->
      <div class="form-check">
        <input 
          class="form-check-input" 
          type="checkbox" 
          id="mixedGroups" 
          [(ngModel)]="mixedGroups">
        <label class="form-check-label" for="mixedGroups">
          Grupos mezclados entre categorías
        </label>
        <div class="form-text">
          Si está marcado, cada grupo tendrá un número equitativo de participantes de cada categoría
        </div>
      </div>
    </div>
  </div>

  <!-- DATOS DE GRUPOS -->
  <div class="card mb-4">
    <div class="card-header bg-success text-white">
      <h2 class="h4 mb-0">Datos de Grupos</h2>
    </div>
    <div class="card-body">
      <!-- Número de grupos -->
      <div class="mb-3">
        <label for="numberOfGroups" class="form-label">Número de Grupos</label>
        <input 
          type="number" 
          class="form-control" 
          id="numberOfGroups" 
          [(ngModel)]="numberOfGroups"
          (change)="onNumberOfGroupsChange()"
          min="1" 
          step="1">
      </div>

      <!-- Tipo de distribución -->
      <div class="mb-3">
        <label for="distributionType" class="form-label">Tipo de Distribución</label>
        <select 
          class="form-select" 
          id="distributionType" 
          [(ngModel)]="distributionType"
          (change)="onDistributionTypeChange()">
          <option [value]="GroupDistributionType.SAME_NUMBER">
            Mismo número de participantes para cada grupo
          </option>
          <option [value]="GroupDistributionType.AUTOMATIC">
            Número de participantes automático
          </option>
          <option [value]="GroupDistributionType.MANUAL">
            Número de participantes manual
          </option>
        </select>
      </div>

      <!-- Mínimo de participantes (solo para automático) -->
      <div class="mb-3" *ngIf="distributionType === GroupDistributionType.AUTOMATIC">
        <label for="minParticipants" class="form-label">Mínimo de Participantes por Grupo</label>
        <input 
          type="number" 
          class="form-control" 
          id="minParticipants" 
          [(ngModel)]="minParticipantsPerGroup"
          min="1" 
          step="1">
        <div class="form-text">
          Los participantes restantes se distribuirán de uno en uno en los grupos
        </div>
      </div>

      <!-- Distribución manual -->
      <div *ngIf="distributionType === GroupDistributionType.MANUAL">
        <label class="form-label">Participantes por Grupo</label>
        <div class="row g-2">
          <div class="col-md-4" *ngFor="let size of manualGroupSizes; let i = index">
            <label [for]="'group' + (i + 1)" class="form-label small">Grupo {{ i + 1 }}</label>
            <input 
              type="number" 
              class="form-control" 
              [id]="'group' + (i + 1)" 
              [(ngModel)]="manualGroupSizes[i]"
              min="1" 
              step="1">
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- DATOS DE PARTICIPANTES -->
  <div class="card mb-4">
    <div class="card-header bg-info text-white">
      <h2 class="h4 mb-0">Datos de Participantes</h2>
    </div>
    <div class="card-body">
      <!-- Añadir participante individual -->
      <div class="row g-2 mb-4">
        <div class="col-md-5">
          <label for="participantName" class="form-label">Nombre del Participante</label>
          <input 
            type="text" 
            class="form-control" 
            id="participantName" 
            [(ngModel)]="newParticipantName"
            (keyup.enter)="addParticipant()"
            placeholder="Nombre del participante">
        </div>
        <div class="col-md-4">
          <label for="participantCategory" class="form-label">Categoría</label>
          <select 
            class="form-select" 
            id="participantCategory" 
            [(ngModel)]="selectedCategoryId">
            <option *ngFor="let category of categories" [value]="category.id">
              {{ category.name }}
            </option>
          </select>
        </div>
        <div class="col-md-3 d-flex align-items-end">
          <button 
            type="button" 
            class="btn btn-primary w-100" 
            (click)="addParticipant()"
            [disabled]="!newParticipantName.trim()">
            Añadir
          </button>
        </div>
      </div>

      <!-- Añadir participantes masivamente -->
      <div class="mb-4">
        <div class="d-flex justify-content-between align-items-center mb-2">
          <label for="bulkParticipants" class="form-label mb-0">Añadir Participantes Masivamente</label>
          <button 
            type="button" 
            class="btn btn-link btn-sm text-decoration-none" 
            (click)="toggleBulkInput()">
            {{ showBulkInput ? 'Ocultar' : 'Mostrar' }}
          </button>
        </div>
        <div *ngIf="showBulkInput">
          <div class="row g-2">
            <div class="col-md-9">
              <textarea 
                class="form-control" 
                id="bulkParticipants" 
                [(ngModel)]="bulkParticipantNames"
                rows="4"
                placeholder="Ingrese nombres separados por comas. Ejemplo: Juan Pérez, María García (P), Carlos López">
              </textarea>
              <div class="form-text">
                Separe los nombres con comas (,) o saltos de línea. Añada (P) después del nombre para marcarlo como pagado. Ejemplo: Juan Pérez (P)
              </div>
            </div>
            <div class="col-md-3">
              <label for="bulkCategory" class="form-label">Categoría</label>
              <select 
                class="form-select mb-2" 
                id="bulkCategory" 
                [(ngModel)]="bulkCategoryId">
                <option *ngFor="let category of categories" [value]="category.id">
                  {{ category.name }}
                </option>
              </select>
              <button 
                type="button" 
                class="btn btn-success w-100" 
                (click)="addBulkParticipants()"
                [disabled]="!bulkParticipantNames.trim()">
                Añadir Todos
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Lista de participantes -->
      <div *ngIf="participants.length > 0">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <h5 class="mb-0">Lista de Participantes ({{ participants.length }})</h5>
          <button 
            type="button" 
            class="btn btn-danger btn-sm" 
            (click)="deleteAllParticipants()"
            title="Borrar todos los participantes">
            <i class="bi bi-trash"></i> Borrar Todos
          </button>
        </div>
        <div class="table-responsive">
          <table class="table table-hover">
            <thead class="table-light">
              <tr>
                <th>Nombre</th>
                <th>Categoría</th>
                <th>Pagado</th>
                <th>Acciones</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let participant of participants">
                <td>
                  <span *ngIf="editingParticipantId !== participant.id">
                    {{ participant.name }}
                  </span>
                  <input 
                    *ngIf="editingParticipantId === participant.id"
                    type="text" 
                    class="form-control form-control-sm" 
                    [(ngModel)]="editingParticipantName"
                    (keyup.enter)="saveEditParticipant(participant)"
                    (keyup.escape)="cancelEdit()">
                </td>
                <td>
                  <span class="badge bg-secondary">
                    {{ getCategoryName(participant.categoryId) }}
                  </span>
                </td>
                <td>
                  <div class="form-check">
                    <input 
                      class="form-check-input" 
                      type="checkbox" 
                      [id]="'paid' + participant.id" 
                      [checked]="participant.isPaid"
                      (change)="togglePaid(participant)">
                    <label class="form-check-label" [for]="'paid' + participant.id">
                      {{ participant.isPaid ? 'Sí' : 'No' }}
                    </label>
                  </div>
                </td>
                <td>
                  <div class="btn-group btn-group-sm" role="group">
                    <button 
                      *ngIf="editingParticipantId !== participant.id"
                      type="button" 
                      class="btn btn-outline-primary" 
                      (click)="startEditParticipant(participant)"
                      title="Editar">
                      <i class="bi bi-pencil"></i> Editar
                    </button>
                    <button 
                      *ngIf="editingParticipantId === participant.id"
                      type="button" 
                      class="btn btn-outline-success" 
                      (click)="saveEditParticipant(participant)"
                      title="Guardar">
                      <i class="bi bi-check"></i> Guardar
                    </button>
                    <button 
                      *ngIf="editingParticipantId === participant.id"
                      type="button" 
                      class="btn btn-outline-secondary" 
                      (click)="cancelEdit()"
                      title="Cancelar">
                      <i class="bi bi-x"></i> Cancelar
                    </button>
                    <button 
                      type="button" 
                      class="btn btn-outline-danger" 
                      (click)="deleteParticipant(participant.id)"
                      title="Eliminar">
                      <i class="bi bi-trash"></i> Eliminar
                    </button>
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <!-- Mensaje cuando no hay participantes -->
      <div *ngIf="participants.length === 0" class="alert alert-info">
        No hay participantes añadidos. Comience añadiendo participantes usando el formulario de arriba.
      </div>
    </div>
  </div>
</div>
